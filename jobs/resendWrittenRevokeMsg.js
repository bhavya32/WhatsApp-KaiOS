"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[118],{681:function(e,r,t){t.r(r),t.d(r,"resendWrittenRevokeMsg",(function(){return m}));var n=t(7),s=t(4),i=t(22),a=t(517),u=t(513),d=t(88),c=t(30),l=t(296),v=t(325),o=t(367),f=t(2),g=t(20),_=t(297),m=(0,d.c)().step("calculateNewDevicesList",(e,r,t)=>{var s=t.interruptJob;return p(e).then(r=>{if(!r)return __LOG__(2)`resendWrittenRevokeMsg msg was deleted`,s();var t=(0,a.g)(r),u=e.originalRecipientsList;return(0,n.w)(t,{user:e=>(0,o.syncDeviceList)(g.l(e)),multicast:()=>{var e=g.m(u.map(n.h));return(0,o.syncDeviceList)(e)}}).then(()=>(0,i.V)(t)).then(e=>({remainingList:g.n(e,u)}))})}).finalStep("encryptAndSend",(e,r)=>{var t=e.remainingList;if(!g.i(t))return p(r).then(e=>{if(e){var r=(0,a.f)(e),n=(0,v.a)(e),i=(0,_.e)(e.dbMsg),d=e.dbMsg.resendCount;return Promise.all(t.map(e=>(0,l.g)(e,n,i,d).then(r=>({encNode:r.encNode,deviceJid:e})))).then(r=>{var t=e.dbMsg,n="group"===e.type||"status"===e.type?(0,l.b)(i):null,u=(0,a.g)(e),d=(0,s.w)("message",{id:(0,s.b)(t.externalId),to:(0,s.g)(u),type:(0,s.b)("text"),edit:(0,_.a)(t),device_fanout:(0,s.b)("false")},(0,s.w)("participants",null,r.map(e=>{var r=e.encNode,t=e.deviceJid;return(0,s.w)("to",{jid:(0,s.g)(t)},r)})),n);return(0,c.g)(d,{id:t.externalId,class:"message",from:u,participant:null})}).then(()=>(0,u.e)(r,f.a.SENT).then(()=>{}))}__LOG__(2)`resendWrittenRevokeMsg msg was deleted`})}).end();function p(e){return void 0!==e.msgId?(0,a.c)(e.msgId):(0,a.d)(e.jid,e.rowId)}}}]);