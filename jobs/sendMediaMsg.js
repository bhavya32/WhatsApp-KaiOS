"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[127],{683:function(t,e,s){s.r(e),s.d(e,"sendStatusMediaMsg",(function(){return l}));var n=s(88),r=s(22),u=s(530),i=s(89),a=s(571),d=s(90),o=s(117),g=s(9);e.default=(0,n.c)().step("writeToDb",(t,e,s)=>{var n=s.jobStartTime,u=e.jid,i=e.request,d=e.key,g=e.quoted,l=e.remoteJid,M=(0,r.q)(d),h=(0,a.c)(M,i,n,l,null);return(function(t){return(0,r.V)(t).then(t=>({to:t,identityIds:new Map}))})(u).then(t=>(0,r.Tc)(u,h,g,t)).then(t=>(t||(__LOG__(2)`sendMediaMsg chat is gone`,(0,o.p)(u,h)),t))}).step("hash",(t,e)=>{var s=e.request;return null!=t?(0,d.e)(s.plaintext).then(e=>({hash:e,result:t})):{}}).finalStep("finish",(t,e)=>{var s=t.result,n=t.hash,r=e.jid,u=e.request;if(s){if(s.outgoingTo){var i=(0,a.e)(s,s.outgoingTo,u,1);return(0,a.a)(i,n)}__LOG__(4)`sendMediaMsg writeOutgoingMsg returned null outgoingTo`,SEND_LOGS("sendMediaMsg-null-outgoingTo");var d=(0,g.L)(r,{user:t=>({type:"user",jid:t,dbMsg:s.dbMsg}),group:t=>({type:"group",jid:t,dbMsg:s.dbMsg})});(0,o.h)(d,{thumbSize:(0,a.b)(u)})}}).end();var l=(0,n.c)().step("writeToDb",(t,e,s)=>{var n=s.jobStartTime;return(0,u.ensureStatusSettingsInitialized)().then(t=>{if("success"!==t)throw __LOG__(4)`sendStatusMediaMsg couldn't fetch settings.`,SEND_LOGS("send-status-no-settings"),new i.b({algo:{type:"constant",delay:3e5}});var s=e.request,u=e.key,d=e.origin,g=(0,r.q)(u),l=(0,a.d)(g,s,n);return(0,r.Uc)(l).then(t=>(t||(0,o.q)(l,d),t))})}).step("hash",(t,e)=>{var s=e.request;return null!=t?(0,d.e)(s.plaintext).then(e=>({hash:e,result:t})):{}}).finalStep("finish",(t,e)=>{var s=t.result,n=t.hash,r=e.request,u=e.origin;if(s)return(0,a.a)({type:"status",to:{to:s.to,identityIds:new Map},dbMsg:s.dbMsg,request:r,requestIdx:1,origin:u},n)}).end()}}]);