"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[114],{659:function(e,r,s){s.r(r);var t=s(8),u=s.n(t),n=s(101),l=s(30),o=s(4),a=s(88),c=s(51),i=s(39),d=s(16),m=s(570),p=s(67),v=s(2),_=s(229),f=s(56),w=s(297),h=s(356),S=s(6),U=s(54),g=s(72),k=s(96),y=s(37),b=s.n(y),x=new c.a("reportUserSpam",e=>({})),G={400:(0,g.d)("bad-request"),500:(0,g.d)("unknown")};r.default=(0,a.c)().step("reportUserSpam",e=>{var r,s=e.userJid,t=e.spamFlow,a=!1;if(null==e.reportType||"chat"===e.reportType)r=(0,p.b)(s).then(e=>null==(null==e?void 0:e.chatId)?[]:(0,m.a)(e.chatId,5));else{if("message"!==e.reportType)return(0,b.a)(e.reportType),{error:{reason:"unknown"}};var c=e.msgId;r=(0,m.b)(c).then(e=>null==e?[]:((0,U.i)(e.dbMsg.author)!==s&&(__LOG__(4)`reportUserSpam: Provided userJid does not match reported message's`,SEND_LOGS("reportUserSpam-userJid-not-match")),[e]))}return(null!=r?r.then(e=>{var r=[];return e.forEach(e=>{try{r.push((function(e,r,s,t){null!=e.secret&&delete e.secret;var u,l,a,c,i=e.ts.toString();e.type===v.f.FUTUREPROOF?(u=new Uint8Array(e.protobuf),l=o.c,a=(0,o.b)("2")):e.type===v.f.CIPHERTEXT?(u=null,l=o.c,a=o.c):null!=e.media||!(0,k.b)(e)||"viewed"!==e.viewOnceState&&"expired"!==e.viewOnceState?(u=(0,n.a)(f.h,(0,_.a)(e,r,s)).readByteArray(),l=(0,w.f)(e),a=(0,o.b)("2")):(l=(0,w.f)(e),a=(0,o.b)("2"),c="viewed"===e.viewOnceState?"view_once_opened":"view_once_expired");var d=(0,U.i)(e.author);if(!d)throw new Error("Incorrect message author");return(0,o.w)("message",{t:(0,o.b)(i),from:(0,o.g)(d),to:(0,o.g)(t),type:l,id:(0,o.b)(e.externalId),deleted_reason:c?(0,o.b)(c):o.c},(0,w.b)(e),(0,w.c)(e),(0,w.d)(e),e.hsmTemplateId?(0,o.w)("hsm",{tid:(0,o.b)(e.hsmTemplateId)}):null,(0,o.w)("raw",{v:a,mediatype:(0,w.e)(e)},u))})(e.dbMsg,e.mediaInfo,e.quoteInfo,S.t.get()))}catch(e){__LOG__(3)`Failed to format message for user spam report: ${e}`,a=!0}}),r}):Promise.resolve([])).then(e=>{var r=(0,o.w)("iq",{to:o.l,type:"set",xmlns:"spam",id:(0,o.u)()},(0,o.w)("spam_list",{jid:(0,o.g)(s),spam_flow:(0,o.b)(t)},e)),n=(0,l.b)(r,x).then(e=>e.success?{result:"success"}:(0,g.f)(e,G));return a?Promise.all([n,(0,h.a)(!1)]).then(e=>u()(e,1)[0]):n})}).step("blockUser",(e,r)=>{var s=r.userJid,t=r.blockUser;return"success"!==e&&e.error?e:t?(S.I.get().mdBlocklistV2?(0,i.b)().waitUntilCompleted(d.e.setBlocklistV2(s,"block")):(0,i.b)().waitUntilCompleted(d.e.blockUser(s))).then(()=>({result:"success-blocked"})):{result:"success"}}).finalStep("deleteChat",(e,r)=>{if("success"!==e&&e.error)return e;var s=r.userJid,t=r.deleteChat;return(0,p.b)(s).then(r=>{var s=null==r?void 0:r.chatId;return null!=s&&t?(0,i.b)().waitUntilCompleted(d.e.deleteChat(s,!1)).then(()=>"success"===e?{result:"success"}:e):"success"===e?{result:"success"}:e})}).end()}}]);