"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[24],{570:function(n,r,t){t.d(r,"a",(function(){return h})),t.d(r,"b",(function(){return p}));var e=t(8),i=t.n(e),s=t(10),u=t(49),o=t(2),a=t(11),l=t(90),f=t(96),m=t(35),c=t(46),d=t(36),g=t(5),v=new Set([o.f.TEXT,o.f.AUDIO,o.f.IMAGE,o.f.PTT,o.f.GIF,o.f.VIDEO,o.f.VCARD,o.f.FUTUREPROOF,o.f.CIPHERTEXT,o.f.MD_PLACEHOLDER,o.f.DOCUMENT]);function h(n,r){return(0,s.f)("loadLastChatMsgs",t=>(0,c.a)(t,"r",["msgs","media","previews","chats"],t=>{var e=(0,d.b)(n),i=(0,d.e)(n);return t.msgs.where("id").between(e,i).reverse().filter(P).limit(r).toArray().then(n=>(0,g.c)(n.map(n=>(0,u.f)(t,n))))}).then(n=>Promise.all(n.filter(Boolean).map(w))))}function p(n){return(0,s.f)("loadLastChatMsgs",r=>(0,c.a)(r,"r",["msgs","media","previews","chats"],r=>(0,d.r)(r,n).then(n=>null!=n&&P(n)?(0,u.f)(r,n):null)).then(n=>null==n?Promise.resolve(null):w(n)))}function w(n){var r=n.dbMsg,t=n.preview,e=n.dbMedia,s=n.quotePreview,u=t?(0,a.h)(t):Promise.resolve();return Promise.all([u.then(n=>(0,l.g)(r.id,n,e)),s&&(0,a.h)(s)]).then(n=>{var t=i()(n,2),e=t[0],s=t[1];return{dbMsg:r,mediaInfo:e,quoteInfo:(0,l.k)(r,s)}})}function P(n){return!(!v.has(n.type)||n.author===o.b||(!(0,f.b)(n)||null==n.viewOnceState)&&(0,m.e)(n)&&!n.media&&(__LOG__(2)`Got media without media id, skipping it`,1))}}}]);