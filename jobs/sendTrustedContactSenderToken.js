"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[134],{707:function(e,t,n){n.r(t),n.d(t,"refreshTrustedContactSenderTokenJob",(function(){return _})),n.d(t,"resendTrustedContactSenderTokenJob",(function(){return v}));var r=n(26),i=n.n(r),s=n(30),u=n(4),o=n(51),d=n(88),c=n(250),a=n(133),f=n(263),k=n(17),l=n(2),p=new o.a("sendTrustedContactSenderToken",e=>{}),_=(0,d.c)().finalStep("deprecatedSendIq",(function(){var e=i()((function*(e,t){var n=e.jid,r=e.ts;if(!(0,k.a)("trusted_contacts_sender"))return"skip";var i=r,s=yield(0,c.c)(n);if(s&&s.ts>i)return"skip";if(s&&!(0,f.a)(s))return"skip";var u=yield y(n,i);return"sent"===u&&(yield(0,c.f)(n,i)),u}));return function(t,n){return e.apply(this,arguments)}})()).end(),v=(0,d.c)().finalStep("deprecatedSendIq",(function(){var e=i()((function*(e){var t=e.jid;if(!(0,k.a)("trusted_contacts_sender"))return __LOG__(4)`sendTrustedContactSenderToken unexpected call`,"skip";var n=yield(0,c.c)(t);return n?y(t,n.ts):"skip"}));return function(t){return e.apply(this,arguments)}})()).end();function y(e,t){return t<(0,f.c)(l.g.TC_SENDER)?"skip":(0,s.b)((0,u.w)("iq",{to:u.l,type:"set",xmlns:"privacy",id:(0,u.u)()},(0,u.w)("tokens",null,(0,u.w)("token",{type:"trusted_contact",jid:(0,u.g)(e),t:(0,u.f)(t)}))),p).then(e=>{if(!e.success){if(4===Math.floor(e.errorCode/100))return __LOG__(4)`Failed to send token generation request: ${e.errorCode} ${e.errorText}`,SEND_LOGS("error-token-generation"),"skip";throw new a.e({algo:{type:"constant",delay:3e5}})}return"sent"})}}}]);