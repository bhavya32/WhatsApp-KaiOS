"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[113],{660:function(e,r,s){s.r(r);var t=s(8),o=s.n(t),u=s(101),a=s(30),n=s(4),c=s(88),i=s(51),l=s(39),p=s(16),m=s(570),d=s(2),f=s(35),v=s(229),_=s(56),w=s(297),h=s(6),G=s(356),g=s(54),y=s(72),S=s(96),b=s(37),k=s.n(b),O=new i.a("reportGroupSpam",e=>({})),j={400:(0,y.d)("bad-request"),500:(0,y.d)("unknown")};r.default=(0,c.c)().step("reportGroupSpam",e=>{var r,s,t=e.groupChat,c=e.spamFlow;if(null==e.reportType||"chat"===e.reportType)r=(0,m.a)(t.id,5);else{if("message"!==e.reportType)return(0,k.a)(e.reportType),{error:{reason:"unknown"}};var i=e.msgId;r=(0,m.b)(i).then(e=>null==e?[]:(e.dbMsg.chat!==t.id&&(__LOG__(4)`reportGroupSpam: Provided chat does not match reported message's`,SEND_LOGS("reportGroupSpam-chat-not-match")),s=(0,g.i)(e.dbMsg.author),[e]))}return r.then(e=>{var r=[],s=!1,i=h.t.get();e.forEach(e=>{try{r.push((function(e,r,s,t,o){var a,c,i,l,p,m=e.ts.toString();if(null!=e.secret&&delete e.secret,e.type===d.f.FUTUREPROOF?(a=new Uint8Array(e.protobuf),c=n.c,i=(0,n.b)("2")):(0,f.i)(e)?(a=null,c=n.c,i=n.c):null!=e.media||!(0,S.b)(e)||"viewed"!==e.viewOnceState&&"expired"!==e.viewOnceState?(a=(0,u.a)(_.h,(0,v.a)(e,r,s)).readByteArray(),c=(0,w.f)(e),i=(0,n.b)("2")):(c=(0,w.f)(e),i=(0,n.b)("2"),l="viewed"===e.viewOnceState?"view_once_opened":"view_once_expired"),e.author===d.c)p=n.c;else if(e.author===d.b)p=(0,n.g)(o);else{var h=(0,g.i)(e.author);if(!h)throw new Error("Author of message is incorrect JID");p=(0,n.g)(h)}return(0,n.w)("message",{t:(0,n.b)(m),from:(0,n.g)(t),participant:p,id:(0,n.b)(e.externalId),type:c,deleted_reason:l?(0,n.b)(l):n.c},(0,w.b)(e),(0,w.c)(e),(0,w.d)(e),e.hsmTemplateId?(0,n.w)("hsm",{tid:(0,n.b)(e.hsmTemplateId)}):null,(0,n.w)("raw",{v:i,mediatype:(0,w.e)(e)},a))})(e.dbMsg,e.mediaInfo,e.quoteInfo,t.jid,i))}catch(e){__LOG__(3)`Failed to format message for group spam report: ${e}`,s=!0}});var l=(0,n.w)("iq",{to:n.l,type:"set",xmlns:"spam",id:(0,n.u)()},(0,n.w)("spam_list",{subject:(0,n.b)(t.groupInfo.title),jid:(0,n.g)(t.jid),spam_flow:(0,n.b)(c)},r)),p=(0,a.b)(l,O).then(e=>e.success?{result:"success"}:(0,y.f)(e,j));return s?Promise.all([p,(0,G.a)(!1)]).then(e=>o()(e,1)[0]):p}).then(e=>e.error||!s?e:Object.assign({},e,{authorJid:s}))}).step("blockUser",(e,r)=>{if("message"!==r.reportType||!0!==r.blockAuthor||e.error||"string"==typeof e)return e;var s=e.authorJid;return s?(h.I.get().mdBlocklistV2?(0,l.b)().waitUntilCompleted(p.e.setBlocklistV2(s,"block")):(0,l.b)().waitUntilCompleted(p.e.blockUser(s))).then(()=>e):e}).step("removeMeFromGroup",(e,r)=>{var s=r.groupChat,t=r.exitGroup;return"success"!==e&&e.error?e:t?(0,l.b)().waitUntilCompleted(p.e.removeGroupParticipants(s.jid,[h.t.get()])).then(()=>({result:"success-left"})):{result:"success"}}).finalStep("deleteGroup",(e,r)=>{var s=r.groupChat,t=r.deleteGroup;return"success"!==e&&e.error?e:t?(0,l.b)().waitUntilCompleted(p.e.deleteChat(s.id,!1)).then(()=>"success"===e?{result:"success"}:e):"success"===e?{result:"success"}:e}).end()}}]);