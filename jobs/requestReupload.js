"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[117],{687:function(e,r,n){n.r(r),n.d(r,"requestReupload",(function(){return v}));var t=n(88),i=n(22),u=n(30),l=n(4),a=n(7),o=n(9),d=n(54),s=n(529),p=n(6),v=(0,t.c)().finalStep("request",e=>{var r=e.msgId;return(0,i.Q)(r).then(e=>{if(e){var n=e.dbMsg,t=e.dbMedia,i=(0,d.i)(n.author);if(null!=i){var v,_;if("status"===e.type)v=o.h,_=i;else{e.type;var f=e.jid,c=(0,a.p)(f);v=c||i,_=null!=c?i:null}var m=n.externalId,y=t.mediaId,G=t.mediaEntries[n.id];if(!G)return __LOG__(4)`requestReupload: no entry found on media ${y} for msg ${r}`,void SEND_LOGS("reupload-entry-not-found");if("mms4"!==G.version)return __LOG__(4)`requestReupload: invalid entry found on media ${y} for msg ${r}`,void SEND_LOGS("reupload-entry-invalid");var L={id:n.externalId,class:"receipt",from:v,participant:_?(0,a.e)(_):null,type:"server-error"};return p.I.get().mms4ServerErrorReceiptEncryptionEnabled?(0,s.d)(G.cryptoKey,m).then(e=>{var r=e.ciphertext,n=e.iv;return(0,u.g)((0,l.w)("receipt",{type:"server-error",to:(0,l.g)(v),participant:_?(0,l.g)(_):l.c,id:(0,l.b)(m)},(0,l.w)("encrypt",null,(0,l.w)("enc_p",null,r),(0,l.w)("enc_iv",null,n))),L)}):(0,u.g)((0,l.w)("receipt",{to:(0,l.g)(v),participant:_?(0,l.g)(_):l.c,id:(0,l.b)(n.externalId),type:"server-error"}),L)}}else __LOG__(2)`downloadMedia msg deleted`})}).end()}}]);