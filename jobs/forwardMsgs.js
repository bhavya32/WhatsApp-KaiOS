"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[94],{657:function(r,e,s){s.r(e);var t=s(8),o=s.n(t),n=s(26),a=s.n(n),i=s(88),d=s(33),u=s(209),f=s(24),g=s(39),_=s(16),w=s(530),l=s(22),v=s(42),c=s(15),M=s(89),m=s(35);e.default=(0,i.c)().finalStep("forwardMsgs",(r,e,s)=>{var t=s.jobStartTime,n=r.msgs,i=r.jids,y=r.toStatus,O=r.key,G=[],I=[];n.forEach(r=>{var e=(0,c.r)(r);y&&e&&I.push({msgId:e,externalId:""}),i.forEach(e=>{G.push({msgId:r,jid:e})})});var L=G.length+I.length;if(0!==L){var p=Promise.all(i.map(r=>(0,l.V)(r).then(e=>[r,e]))).then(r=>new Map(r));return Promise.all([(0,u.a)(new Uint8Array((0,d.k)(O)),"Forward Message Keys",7*L),p]).then((function(){var r=a()((function*(r){var e=o()(r,2),s=e[0],n=e[1],a=new f.a(s),i=[];if(G.forEach(r=>{var e=(0,l.q)((0,d.m)(a.readByteArray(7))),s=n.get(r.jid);s&&i.push(Object.assign({},r,{externalId:e,outgoingTo:{to:s,identityIds:new Map}}))}),I.length>0&&"success"!==(yield(0,w.ensureStatusSettingsInitialized)()))throw __LOG__(4)`forwardMsg to status couldn't fetch status settings.`,SEND_LOGS("send-status-no-settings"),new M.b({algo:{type:"constant",delay:3e5}});for(var u=0;u<I.length;u++)I[u].externalId=(0,l.q)((0,d.m)(a.readByteArray(7)));return(0,l.Pc)(t,i,I)}));return function(e){return r.apply(this,arguments)}})()).then(r=>{r.length!==L&&__LOG__(2)`Failed to forward all messages`;var e=r.map(r=>{var e=r.dbMsg;if("deduped"!==r.result||!(0,v.l)(e.ack)){var s;if(r.chat){if(!r.outgoingTo)return __LOG__(4)`forwardMsgs MsgWrittenResult without outgoingTo`,void SEND_LOGS("forwardMsgs-null-outgoingTo");s=r.outgoingTo}else s={to:r.to,identityIds:new Map};var t={from:"forwardFromMessages"};return(0,m.e)(e)?(0,g.b)().waitUntilPersisted(_.e.uploadMedia(e.id,s,t)):(0,g.b)().waitUntilPersisted(_.e.sendWrittenMsg(r.dbMsg.id,s,t,void 0))}});return Promise.all(e)}).then(()=>{})}__LOG__(4)`forwardMsgs no messages to send`}).end()}}]);