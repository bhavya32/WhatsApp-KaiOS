"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[86],{668:function(e,n,i){i.r(n);var r=i(26),t=i.n(r),a=i(22),c=i(67),u=i(88),v=i(3),_=i(20),s=i(41),f=i(17),o=i(133),d=i(39),l=i(16);n.default=(0,u.c)().step("deleteDevices",(function(){var e=t()((function*(e,n,i){var r=i.interruptJob;if(!(0,f.a)("adv_v2_m4_m5"))return r();var t=(0,f.a)("num_days_before_device_expiry_check"),u=Math.min(35,t);u<0&&(u=0);var _=(0,f.a)("num_days_key_index_list_expiration"),o=Math.min(35,_);o<1&&(o=1);var d=[],l=new Set,y=yield(0,c.c)(),m=yield(0,a.E)();if(y.forEach(e=>{var n=e.deviceVerification;if(n){var i=(0,v.i)(n.timestamp),r=(0,v.k)(o*v.b,i),t=(0,v.D)();t>=r||(function(e,n,i){if(null==e||0===e)return!1;var r=(0,v.i)(e),t=(0,v.k)(25*v.d,r);return(0,v.D)()>=t&&n!==i})(n.expectedTsUpdatedTs,n.deleteExpiredDeviceTs,m.lastRunTs)?(d.push({jid:e.jid,devices:e.devices}),l.add(e.jid)):t>=(0,v.w)(u*v.b,r)&&l.add(e.jid)}}),d.length>=1){__LOG__(2)`Expiring contacts ${d.length}`;var h=[];d.forEach(e=>{var n=e.devices;null!=n&&h.push((0,s.l)(e.jid,n.map(e=>e.id)))}),yield Promise.all(h),yield(0,a.p)(d.map(e=>e.jid))}return{usersToSync:l,completionTime:Date.now()}}));return function(n,i,r){return e.apply(this,arguments)}})()).finalStep("syncDeviceAndSaveInfo",(function(){var e=t()((function*(e){if(!(e instanceof o.b)){var n=e.usersToSync,i=e.completionTime;n.size>=1&&(__LOG__(2)`Syncing devices ${n.size}`,yield(0,d.b)().waitUntilCompleted(l.e.syncDeviceList((0,_.c)(n)))),yield(0,a.Gc)({lastRunTs:i})}}));return function(n){return e.apply(this,arguments)}})()).end()}}]);