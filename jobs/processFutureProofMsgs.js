"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[105],{703:function(e,r,o){o.r(r),o.d(r,"processFutureProofMsgs",(function(){return G}));var u=o(8),t=o.n(u),f=o(7),n=o(9),l=o(22),s=o(321),i=o(75),a=o(56),p=o(150),_=o(2),d=o(88),v=o(440),c=o(187),b=o(52),g=o(230),h=o(184),k=o(441),m=o(185),L=o(11),G=(0,d.c)().finalStep("processFutureProofMsgs",()=>(0,s.b)().then(e=>{__LOG__(2)`processFutureProofMsgs received ${e.length} handleable future proof messages`;var r=0,o=0,u=[];function s(e,t){"futureproof-handled"===t?o++:r++,u.push(()=>(0,l.m)(e.chat,[e.id],t))}e.forEach(e=>{var r=t()(e,2),o=r[0],d=r[1];if("deleted"===d)return s(o,"futureproof-broken"),null;var L=(function(e,r){var o;try{o=(0,i.a)(a.h,e.protobuf)}catch(r){return __LOG__(3)`processFutureProofMsgs failed to decode protobuf for ${e.id}`,null}var u=e.author,t=e.deviceId;if("@me"===u||"@system"===u)return null;var l=(0,f.B)(u,t||n.c);return{externalId:e.externalId,jid:r,author:l,ts:e.ts,proto:o,bytes:new Uint8Array(e.protobuf),edit:-1,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,bspInfo:null,pushname:null,urlNumber:!1,urlText:!1,expiration:null}})(o,d);if(L)switch(o.subtype){case"reaction":if(!(0,b.b)())return;if(!L.proto.reactionMessage)return __LOG__(4)`Reaction futureproof proto without message. Deleting`,void s(o,"futureproof-broken");var G=(0,v.a)(L,L.proto.reactionMessage);if(!G)return __LOG__(4)`Invalid futureproof reaction protobuf. Deleting`,void s(o,"futureproof-broken");u.push(()=>(0,c.j)(G)),s(o,"futureproof-handled");break;case"pollUpdate":if(!(0,b.q)())return;var O=L.proto.pollUpdateMessage;if(null==O)return __LOG__(4)`Poll update futureproof proto without message. Deleting`,void s(o,"futureproof-broken");L.meta={pollType:"vote"};var w=(0,g.d)(L,O);if(null==w)return __LOG__(4)`Invalid futureproof poll update protobuf. Deleting`,void s(o,"futureproof-broken");if("futureproof"===w)return;u.push(()=>(0,h.k)(w)),s(o,"futureproof-handled");break;case"keepInChat":if(!(0,b.l)())return;var P=L.proto.keepInChatMessage;if(null==P)return __LOG__(4)`Keep in chat futureproof proto without message. Deleting`,void s(o,"futureproof-broken");var D=(0,k.a)(L,P);if(null==D)return __LOG__(4)`Invalid futureproof keep in chat protobuf. Deleting`,void s(o,"futureproof-broken");u.push(()=>(0,m.h)(D)),s(o,"futureproof-handled");break;default:var F=(0,p.i)(L);if(!F)return __LOG__(4)`Invalid futureproof protobuf. Deleting`,void s(o,"futureproof-broken");if(F.msg.type===_.f.FUTUREPROOF)return;F.msg.type===_.f.EPHEMERAL?s(o,"futureproof-broken"):u.push(()=>(0,l.Qc)(L.jid,F))}else s(o,"futureproof-broken")});var d=u.length-o-r;return(0,L.r)(u).then(()=>{__LOG__(2)`processFutureProofMsgs ${d} messages were processed`,__LOG__(2)`processFutureProofMsgs ${o} messages were removed (handled)`,__LOG__(2)`processFutureProofMsgs ${r} messages were removed (broken)`})}).then(()=>{})).end()}}]);