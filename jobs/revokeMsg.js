"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[121],{676:function(e,r,t){t.r(r),t.d(r,"revokeStatusMsgJob",(function(){return M}));var o=t(88),s=t(22),u=t(547),i=t(596),n=t(7),v=t(11),a=t(42),g=t(219),d=t(9),f=t(117);r.default=(0,o.c)().step("saveInviteGroupJids",e=>{var r=e.chatJid,t=e.msgIds,o=(0,n.q)(r);return(o?(0,s.X)(o,t):Promise.resolve()).then(e=>({groupInvites:e}))}).finalStep("revokeChatMsgs",(e,r)=>{var t,o=r.chatJid,s=r.msgIds;return e&&(e.groupInvites?t=e.groupInvites:null==e.chatJid&&(t=e)),(0,g.e)(o,s).then(e=>{var r=e.filter(e=>!(0,a.l)(e.dbMsg.ack)).map(e=>{if(!e.outgoingTo)return __LOG__(4)`revokeMsg revokeChatMsgs returned MsgWrittenResult without outgoingTo`,void SEND_LOGS("revokeMsg-null-outgoingTo");var r=e.outgoingTo.to,t=(0,d.L)(e.chat.jid,{user:r=>({type:"user",msgType:"chat",jid:r,dbMsg:e.dbMsg,mediaInfo:void 0,quoteInfo:void 0}),group:r=>({type:"group",msgType:"chat",jid:r,dbMsg:e.dbMsg,mediaInfo:void 0,quoteInfo:void 0})});return(0,u.a)(t,r).then(e=>{"sent"===e&&(0,f.j)(t,{})})}),s=(0,n.q)(o);if(t&&s){var g=t,M=(0,v.x)(g);r.push(Promise.all(M.map(e=>(0,i.revokeGroupInvitations)(e,[g[e]]))))}return Promise.all(r).then(()=>{})})}).end();var M=(0,o.c)().finalStep("revokeStatusMsg",e=>{var r=e.statusMsgId;return(0,s.Yb)(r).then(e=>{if(e){if(!(0,a.l)(e.dbMsg.ack)){var r={to:e.to,identityIds:new Map};return(0,u.b)({type:"status",dbMsg:e.dbMsg,mediaInfo:void 0},r.to).then(()=>{})}__LOG__(2)`revokeStatusMsg: revoke already sent`}else __LOG__(2)`revokeStatusMsg: no result`})}).end()}}]);