"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[130],{679:function(e,n,t){t.r(n),t.d(n,"sendStatusMsg",(function(){return _}));var i=t(26),r=t.n(i),u=t(117),l=t(22),o=t(67),d=t(312),s=t(88),a=t(530),v=t(39),c=t(16),f=t(228),g=t(70),y=t(89),p=t(42);n.default=(0,s.c)().finalStep("saveAndPassOff",(function(){var e=r()((function*(e,n,t){var i=t.jobStartTime,r=e.jid,o=e.key,d=e.content,s=e.quoted,a=e.link,f=e.remoteJid,g=(0,l.q)(o),y=yield(function(e,n,t,i,r,u){return h.apply(this,arguments)})(g,d,i,f,null,a),_=yield(0,l.V)(r),w=yield(0,l.Tc)(r,y,s,{to:_,identityIds:new Map});if(w&&!(0,p.l)(w.dbMsg.ack)){var x=w.outgoingTo;if(!x)return __LOG__(4)`sendMsg writeOutgoingMsg returned null outgoingTo`,SEND_LOGS("sendMsg-null-outgoingTo"),void(0,u.p)(r,y);yield(0,v.b)().waitUntilPersisted(c.e.sendWrittenMsg(w.dbMsg.id,x))}}));return function(n,t,i){return e.apply(this,arguments)}})()).end();var _=(0,s.c)().finalStep("saveAndPassOff",(function(){var e=r()((function*(e,n,t){var i=t.jobStartTime,r=e.key,o=e.content,s=e.origin,f=(0,l.q)(r),g=yield(function(e,n,t,i){n.type;var r=w(void 0);return(0,d.l)(e,t,{text:n.text,linkPreview:null==r?void 0:r.linkPreview,backgroundColor:n.backgroundColor,font:n.font},(null==r?void 0:r.preview)||null)})(f,o,i);if("success"!==(yield(0,a.ensureStatusSettingsInitialized)()))throw __LOG__(4)`sendStatusMsg couldn't fetch settings.`,SEND_LOGS("send-status-no-settings"),new y.b({algo:{type:"constant",delay:3e5}});var _=yield(0,l.Uc)(g);if(_){if(!(0,p.l)(_.dbMsg.ack)){var h={to:_.to,identityIds:new Map};yield(0,v.b)().waitUntilPersisted(c.e.sendWrittenMsg(_.dbMsg.id,h,s))}}else(0,u.q)(g,s)}));return function(n,t,i){return e.apply(this,arguments)}})()).end();function w(e){var n,t;return e?{linkPreview:{matchedText:e.matchedText,canonicalUrl:e.canonicalUrl,description:null!=(n=e.description)?n:void 0,title:null!=(t=e.title)?t:void 0},preview:e.imgBlob||void 0}:null}function h(){return(h=r()((function*(e,n,t,i,r,u){switch(n.type){case"text":var l,s,a=w(u);return(0,d.o)(e,t,i,r,{text:n.text,linkPreview:null==a?void 0:a.linkPreview,urlNumber:null==(l=n.waMe)?void 0:l.urlNumber,urlText:null==(s=n.waMe)?void 0:s.urlText},(null==a?void 0:a.preview)||null);case"vcard":var v=(0,f.k)(n.contacts.map(e=>e.vcard)),c=yield(0,o.d)(Array.from(v)),y=n.contacts.map(e=>{var n=e.vcard;return{displayName:e.displayName,vcard:(0,f.a)(n,c)}});return(0,d.p)(e,t,i,{contacts:y});case"location":return(0,d.i)(e,t,i,{degreesLatitude:n.lat,degreesLongitude:n.lng,name:n.name||void 0,address:n.address||void 0,url:n.url||void 0},n.previewBlob||null);case"group_invite":var p=yield(0,g.getProfilePicTable)().getThumb(n.groupJid);return(0,d.f)(e,t,i,{groupJid:n.groupJid,inviteCode:n.inviteCode,inviteExpiration:n.inviteExpiration,groupName:n.groupName,caption:n.caption},p&&p.image||null);default:return n.type,(0,d.g)(e,t,i,{selectedDisplayText:n.selectedDisplayText,payload:n.payload,selectedButtonIndex:n.selectedButtonIndex})}}))).apply(this,arguments)}}}]);