"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[67],{625:function(e,r,t){t.r(r);var i=t(26),a=t.n(i),n=t(114),d=t(4),o=t(39),u=t(16),c=t(22),y=t(529),l=t(11),s=t(7),_=new n.b("incomingMediaRetryNotificationParser",e=>{e.assertTag("notification");var r=e.attrFromPhoneJid(),t=e.attrString("id"),i=e.maybeChild("encrypt");return i?{type:"encrypted",from:r,externalId:t,ciphertext:i.child("enc_p").contentBytes(),iv:i.child("enc_iv").contentBytes()}:{type:"plaintext",from:r,externalId:t}});r.default=(0,n.c)("handleMediaRetry",_,e=>{var r=(0,d.w)("ack",{id:(0,d.b)(e.externalId),to:(0,d.m)(e.from),participant:(0,d.j)(e.from),class:"notification",type:"mediaretry"}),t=(function(e,r){var t=(0,s.h)(e.author);switch(e.type){case"device":return{type:"user",jid:e.chat,author:t,externalId:r};case"group":return{type:"group",jid:e.chat,author:t,externalId:r};case"status":return{type:"status",author:t,externalId:r};default:return e.type,{type:"user",jid:e.chat,author:t,externalId:r}}})(e.from,e.externalId);return(0,c.R)(t).then((function(){var r=a()((function*(r){if(r){var t=r.dbMsg,i=r.dbMedia,a=t.id,n=i.mediaId;if(null!=i.lastDownloadAttempt){if("encrypted"===e.type){var d=i.mediaEntries[a];if(!d||"mms4"!==d.version)return void __LOG__(3)`handleMediaRetry: no valid entry for media ${n} for msg ${a}`;var s=yield(0,y.a)(d.cryptoKey,e.externalId,e.iv,e.ciphertext),_=s.stanzaId,f=s.directPath;if(_!==e.externalId)return __LOG__(4)`handleMediaRetry: invalid encrypted stanzaId received`,void SEND_LOGS("media-retry-invalid-stanza-id");__LOG__(2)`mediaretry updating media entry directPath`,yield(0,c.ic)(n,a,(0,l.j)(d,{directPath:f}))}return(0,o.b)().waitUntilPersisted(u.e.downloadMedia(a,"retry"))}__LOG__(3)`mediaretry received for media ${n} but we never tried to download`}else __LOG__(3)`handleMediaRetry: no mesage found`}));return function(e){return r.apply(this,arguments)}})()).then(()=>r)})}}]);