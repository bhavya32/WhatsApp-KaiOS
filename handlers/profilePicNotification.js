"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[70],{622:function(e,t,i){i.r(t);var r=i(114),a=i(399),s=i(22),o=i(7),d=i(70),n=i(2),c=i(12),u=i(4),l=i(614),f=i(523),p=new r.b("incomingProfilePicNotificationParser",e=>{var t,i;if(e.assertTag("notification"),e.hasChild("delete"))t="delete",i=e.child("delete");else if(e.hasChild("set"))t="set",i=e.child("set");else{if(!e.hasChild("request"))return e.throw("Expected child type to be one of: set, delete, request");t="request",i=e.child("request"),(0,a.a)(i,"jid")}var r=e.attrString("id");return i.hasAttr("jid")?{type:t,from:e.attrPhoneChatJid("from"),jid:i.attrPhoneChatJid("jid"),author:(0,a.b)(i,"author"),ts:e.attrTime("t"),rawTs:e.attrString("t"),stanzaId:r,picId:"set"===t?i.attrInt("id",1):0}:{from:e.attrPhoneUserJid("from"),type:t,hash:i.attrString("hash"),stanzaId:r}});function h(e,t){switch(e){case"delete":return(0,c.c)("event","avatarsUpdated",{changed:[{jid:t,photoId:null}]}),(0,d.getProfilePicTable)().storeEmptyThumb(t);case"set":return(0,c.c)("event","avatarsUpdated",{cleared:[t]}),(0,d.getProfilePicTable)().clearRecord(t);default:return(0,l.resendProfilePicture)()}}t.default=(0,r.c)("handleProfilePicNotification",p,e=>{if(void 0!==e.jid){var t=e.jid,i=e.rawTs,r=e.picId,a=e.ts,d=e.author,c=e.type,l=h(c,t),p=(0,o.p)(t)&&(0,s.Qc)(t,{msg:{externalId:JSON.stringify([i,r]),ts:a,author:d,ack:n.a.RECEIVED,type:n.f.GROUP_NOTIFICATION,subtype:"delete"===c?"picture_remove":"picture",altIndex:""}});return Promise.all([l,p]).then(()=>(0,u.w)("ack",{id:(0,u.b)(e.stanzaId),to:(0,u.g)(e.from),class:"notification",type:"picture"}))}return(0,f.a)(e.hash).then(t=>Promise.all(t.map(t=>h(e.type,t)))).then(()=>(0,u.w)("ack",{id:(0,u.b)(e.stanzaId),to:(0,u.g)(e.from),class:"notification",type:"picture"}))})}}]);