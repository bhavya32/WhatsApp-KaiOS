"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[57],{624:function(t,e,a){a.r(e),a(74);var n=a(114),r=a(4),i=a(67),c=a(70),o=a(12),s=a(170),d=a(3),u=a(39),f=a(16),p=a(523),v=new n.b("incomingContactsNotification",t=>{t.assertTag("notification");var e=t.attrString("id"),a={from:t.attrWapJid("from"),ts:t.attrTime("t"),rawTs:t.attrString("t"),stanzaId:e};if(t.hasChild("update")){var n=t.child("update");return n.hasAttr("jid")?Object.assign({type:"update",jid:n.attrPhoneUserJid("jid")},a):n.hasAttr("hash")?Object.assign({type:"updateFromHash",hash:n.attrString("hash")},a):Object.assign({type:"empty"},a)}if(t.hasChild("add")){var r=t.child("add");return Object.assign({type:"add",hash:r.hasContent()?r.contentBytes():null},a)}if(t.hasChild("remove")){var i=t.child("remove");return Object.assign({type:"remove",jid:i.attrPhoneUserJid("jid")},a)}if(t.hasChild("sync")){var c=t.child("sync");return Object.assign({type:"sync",after:c.attrTime("after")},a)}return __LOG__(4)`Unexpected 'contacts' notification`,Object.assign({type:"empty"},a)});function y(t){if(!t)return Promise.resolve();var e=t.jid,a=t?(0,u.b)().waitUntilPersisted(f.e.getUserAbout(e)):null;(0,o.c)("event","clearUserLastSeen",{jid:e}),(0,o.c)("event","avatarsUpdated",{cleared:[e]});var n=(0,c.getProfilePicTable)().clearRecord(e);return Promise.all([a,n])}function h(t,e){return(0,r.w)("ack",{id:(0,r.b)(t.stanzaId),to:t.from,class:"notification",type:"contacts"},e)}e.default=(0,n.c)("handleContactsNotification",v,t=>{switch(t.type){case"updateFromHash":var e=t.hash;return(0,p.a)(e).then(t=>(0,i.c)(t)).then(t=>Promise.all(t.map(y))).then(()=>h(t));case"update":var a=t.jid;return(0,i.b)(a).then(y).then(()=>h(t));case"sync":var n=t.after-t.ts,r=(0,d.k)(n);return(0,s.d)("sync",r),h(t);default:return __LOG__(2)`handleContactsNotification: unhandled notification of type ${t.type}`,h(t)}})}}]);