"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[61],{724:function(n,e,i){i.r(e),i.d(e,"handleAccountSyncNotification",(function(){return v}));var t=i(114),c=i(4),o=i(6),s=i(7),r=i(26),a=i.n(r),d=i(71);function u(){return(u=a()((function*(n){return Promise.resolve()}))).apply(this,arguments)}i(576),i(201),i(389),i(39),i(16),i(56);var f=new t.b("accountSyncNotification",n=>{var e=n.attrString("id"),i=n.attrPhoneDeviceJid("from");if(n.hasChild("devices")){var t=(function(n){if("devices"!==n.tag())throw new Error("Expected devices node");return"modify"===n.maybeAttrString("action")?{type:"devices-modify"}:{type:"devices-sync",devices:n.mapChildrenWithTag("device",n=>({jid:n.attrPhoneDeviceJid("jid"),keyIndex:(0,d.g)(n,"key-index")||d.b})),advTs:n.hasChild("key-index-list")?n.child("key-index-list").attrInt("ts"):null}})(n.child("devices"));return"devices-modify"===t.type?{type:"devices-modify",stanzaId:e,from:i}:{type:"devices-sync",devices:t.devices,advTs:t.advTs,stanzaId:e,from:i}}var c=n.maybeChild("tos");if(c){var o=c.child("notice");return{type:"tos",stanzaId:e,from:i,noticeId:o.attrInt("id"),state:"false"!==o.maybeAttrString("state")}}var s=null;return n.hasChild("blocklist")?s="blocklist":n.hasChild("picture")?s="picture":n.hasChild("privacy")?s="privacy":(s="unknown",__LOG__(4)`Unknown account sync notification: ${n}`,SEND_LOGS("account-sync-notification-received-unknown")),{type:"unknown",action:s,stanzaId:e,from:i}}),v=(0,t.c)("handleAccountSyncNotification",f,n=>{if(o.t.get()!==(0,s.h)(n.from))return __LOG__(4)`Received account sync notificaton from non-self`,SEND_LOGS("account-sync-notification-self"),y(n);var e=null;return"devices-modify"===n.type?e=Promise.resolve():"devices-sync"===n.type?e=(function(n){return u.apply(this,arguments)})(n):"tos"===n.type?e=i.e(151).then(i.bind(null,706)).then(e=>e.maybeUpdateTOSStatusFromNotification(n.noticeId,n.state)):(n.type,__LOG__(3)`Received unhandled ${n.action} account sync notification.`,e=Promise.resolve()),e.then(()=>y(n))});function y(n){var e=n.from,i=n.stanzaId;return(0,c.w)("ack",{to:(0,c.g)(e),id:(0,c.b)(i),type:(0,c.b)("account_sync"),class:"notification"})}}}]);